---
title: "Test"
author: "Amy Zhu"
date: "July 19, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
library(reshape)

#read data
stop_df <- read.csv("~/Desktop/Berkeley_PD_-_Stop_Data.csv")

# Delete meaningless information and fix typos
stop_df <- stop_df %>%
  mutate(Dispositions = as.character(stop_df$Dispositions)) %>%
  mutate(Dispositions = str_replace(Dispositions, "zz do not use Assist", "")) %>%
  mutate(Dispositions = str_replace(Dispositions, "FA - TIGHT, ", "")) %>%
  mutate(Dispositions = str_replace(Dispositions, "[0]{6}[1]?", "00000"))

# Split information about the individual from other information
stop_df <- stop_df %>%
  mutate(Other = str_replace_all(Dispositions, "[ ,]{0,2}[a-zA-Z0-9]{6}", "")) %>%
  mutate(Other = str_replace_all(Other, "^[ ,]{0,4}", "")) %>%
  mutate(Other = str_replace(Other, ",$", ""))


# Delete other information from Disposition
OtherInformation <- c( "^M$" = "", ", M$" = "", "M, P$" = "", "P[, ]{0,2}" = "", "AR[, ]{0,2}" = "", "IN[, ]{0,2}" = "", "FC[, ]{0,2}" = "", "CO[, ]{0,2}" = "", "MH[, ]{0,2}" = "", "TOW[, ]{0,2}" = "", "0[, ]{0,2}" = "", "00000[, ]{0,2}" = "")
stop_df <- stop_df %>%
  mutate(Dispositions = str_replace_all(Dispositions, OtherInformation)) %>%
  mutate(Dispositions = str_replace_all(Dispositions, "[, ]{0,2}$", ""))

# Creating new entries for multiple people in one disposition
stop_df <- stop_df %>%
  separate(Dispositions, into = c("1", "2", "3", "4", "5"), extra = "merge", fill = "right") %>%
  gather(key = Individual, value = Dispositions, -Incident.Type, -Incident.Number, -Call.Date.Time, -Location, -Other) %>%
  na.omit() %>%
  arrange(Incident.Number)

# Separate information about people
stop_df<- stop_df %>%
    filter(nchar(Dispositions) == 6) %>%
      mutate(Race = substr(Dispositions,1,1)) %>%
        mutate(Gender = substr (Dispositions,2,2)) %>%
          mutate(AgeRange = substr (Dispositions,3,3)) %>%
            mutate(Reason =substr(Dispositions,4,4)) %>%
              mutate(Enforcement = substr(Dispositions,5,5)) %>%
                 mutate(CarSearch = substr(Dispositions,6,6))

View(stop_df)

```


