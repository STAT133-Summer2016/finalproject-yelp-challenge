---
title: "Test"
author: "Amy Zhu"
date: "July 19, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyr)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
library(reshape)

#read data
stop_df <- read.csv("~/Desktop/Berkeley_PD_-_Stop_Data.csv")

# Delete meaningless information and fix typos
stop_df <- stop_df %>%
  mutate(Dispositions = as.character(stop_df$Dispositions)) %>%
  mutate(Dispositions = str_replace(Dispositions, "zz do not use Assist", "")) %>%
  mutate(Dispositions = str_replace(Dispositions, "FA - TIGHT, ", "")) %>%
  mutate(Dispositions = str_replace(Dispositions, "[0]{6}[1]?", "00000"))

# Split information about the individual from other information
stop_df <- stop_df %>%
  mutate(Other = str_replace_all(Dispositions, "[ ,]{0,2}[a-zA-Z0-9]{6}", "")) %>%
  mutate(Other = str_replace_all(Other, "^[ ,]{0,4}", "")) %>%
  mutate(Other = str_replace(Other, ",$", ""))


# Delete other information from Disposition
OtherInformation <- c( "^M$" = "", ", M$" = "", "M, P$" = "", "P[, ]{0,2}" = "", "AR[, ]{0,2}" = "", "IN[, ]{0,2}" = "", "FC[, ]{0,2}" = "", "CO[, ]{0,2}" = "", "MH[, ]{0,2}" = "", "TOW[, ]{0,2}" = "", "0[, ]{0,2}" = "", "00000[, ]{0,2}" = "")
stop_df <- stop_df %>%
  mutate(Dispositions = str_replace_all(Dispositions, OtherInformation)) %>%
  mutate(Dispositions = str_replace_all(Dispositions, "[, ]{0,2}$", ""))

# Creating new entries for multiple people in one disposition
stop_df <- stop_df %>%
  separate(Dispositions, into = c("1", "2", "3", "4", "5"), extra = "merge", fill = 
             "right") %>%
  gather(key = Individual, value = Dispositions, -Incident.Type, -Incident.Number, -Call.Date.Time, -Location, -Other) %>%
  na.omit() %>%
  arrange(Incident.Number)




View(stop_df)



###IGNORE EVERYTHING AFTER THIS

dispositions <- separate(stop_df, Dispositions, into = c("Individual_1", "Individual_2", "Individual_3", "Individual_4", "Individual_5", "Individual_6"), extra = "merge", fill = "right")

#deconstructing_6_characters <- function (x) {
 # dispositions %>%
  #  filter(nchar(x) == 6) %>%
   #   mutate(Race_x = substr(x,1,1)) %>%
    #    mutate(Gender_x = substr (x,2,2)) %>%
     #     mutate(AgeRange_x = substr (x,3,3)) %>%
      #      mutate(Reason_x =substr(x,4,4)) %>%
       #       mutate(Enforcement_x = substr(x,5,5)) %>%
        #         mutate(CarSearch_x = substr(x,6,6))
#}
#lapply

dispositions_6_characters_1 <- dispositions %>%
    filter(nchar(Individual_1) == 6) %>%
      mutate(Race_1 = substr(Individual_1,1,1)) %>%
        mutate(Gender_1 = substr (Individual_1,2,2)) %>%
          mutate(AgeRange_1 = substr (Individual_1,3,3)) %>%
            mutate(Reason_1 =substr(Individual_1,4,4)) %>%
              mutate(Enforcement_1 = substr(Individual_1,5,5)) %>%
                 mutate(CarSearch_1 = substr(Individual_1,6,6))

dispositions_6_characters_2 <- dispositions %>%
    filter(nchar(Individual_2) == 6) %>%
      mutate(Race_2 = substr(Individual_2,1,1)) %>%
        mutate(Gender_2 = substr (Individual_2,2,2)) %>%
          mutate(AgeRange_2 = substr (Individual_2,3,3)) %>%
            mutate(Reason_2 =substr(Individual_2,4,4)) %>%
              mutate(Enforcement_2 = substr(Individual_2,5,5)) %>%
                 mutate(CarSearch_2 = substr(Individual_2,6,6))

dispositions_6_characters_3 <- dispositions %>%
    filter(nchar(Individual_3) == 6) %>%
      mutate(Race_3 = substr(Individual_3,1,1)) %>%
        mutate(Gender_3 = substr (Individual_3,2,2)) %>%
          mutate(AgeRange_3 = substr (Individual_3,3,3)) %>%
            mutate(Reason_3 =substr(Individual_3,4,4)) %>%
              mutate(Enforcement_3 = substr(Individual_3,5,5)) %>%
                 mutate(CarSearch_3 = substr(Individual_3,6,6))

dispositions_6_characters_4 <- dispositions %>%
    filter(nchar(Individual_4) == 6) %>%
      mutate(Race_4 = substr(Individual_4,1,1)) %>%
        mutate(Gender_4 = substr (Individual_4,2,2)) %>%
          mutate(AgeRange_4 = substr (Individual_4,3,3)) %>%
            mutate(Reason_4 =substr(Individual_4,4,4)) %>%
              mutate(Enforcement_4 = substr(Individual_4,5,5)) %>%
                 mutate(CarSearch_4 = substr(Individual_4,6,6))

dispositions_6_characters_5 <- dispositions %>%
    filter(nchar(Individual_5) == 6) %>%
      mutate(Race_5 = substr(Individual_5,1,1)) %>%
        mutate(Gender_5 = substr (Individual_5,2,2)) %>%
          mutate(AgeRange_5 = substr (Individual_5,3,3)) %>%
            mutate(Reason_5 =substr(Individual_5,4,4)) %>%
              mutate(Enforcement_5 = substr(Individual_5,5,5)) %>%
                 mutate(CarSearch_5 = substr(Individual_5,6,6))

dispositions_6_characters_6 <- dispositions %>%
    filter(nchar(Individual_6) == 6) %>%
      mutate(Race_6 = substr(Individual_6,1,1)) %>%
        mutate(Gender_6 = substr (Individual_6,2,2)) %>%
          mutate(AgeRange_6 = substr (Individual_6,3,3)) %>%
            mutate(Reason_6 =substr(Individual_6,4,4)) %>%
              mutate(Enforcement_6 = substr(Individual_6,5,5)) %>%
                 mutate(CarSearch_6 = substr(Individual_6,6,6))

#View(dispositions_1)
#View(dispositions_2)
#View(dispositions_3)
#View(dispositions_4)
#View(dispositions_5)
#View(dispositions_6)

#deconstructing_other_characters <- function(x) {
#}
#lapply

dispositions_other_characters_1 <- dispositions  %>%
  filter(nchar(Individual_1) == 1 | nchar(Individual_1) == 2 | nchar(Individual_1) == 3 | nchar(Individual_1) == 5) %>%
    mutate(Other_1 = Individual_1) 

dispositions_other_characters_2 <- dispositions  %>%
  filter(nchar(Individual_2) == 1 | nchar(Individual_2) == 2 | nchar(Individual_2) == 3 | nchar(Individual_2) == 5) %>%
    mutate(Other_2 = Individual_2) 

dispositions_other_characters_3 <- dispositions  %>%
  filter(nchar(Individual_3) == 1 | nchar(Individual_3) == 2 | nchar(Individual_3) == 3 | nchar(Individual_3) == 5) %>%
    mutate(Other_3 = Individual_3) 

dispositions_other_characters_4 <- dispositions  %>%
  filter(nchar(Individual_4) == 1 | nchar(Individual_4) == 2 | nchar(Individual_4) == 3 | nchar(Individual_4) == 5) %>%
    mutate(Other_4 = Individual_4) 

dispositions_other_characters_5 <- dispositions  %>%
  filter(nchar(Individual_5) == 1 | nchar(Individual_5) == 2 | nchar(Individual_5) == 3 | nchar(Individual_5) == 5) %>%
    mutate(Other_5 = Individual_5) 

dispositions_other_characters_6 <- dispositions  %>%
  filter(nchar(Individual_6) == 1 | nchar(Individual_6) == 2 | nchar(Individual_6) == 3 | nchar(Individual_6) == 5) %>%
    mutate(Other_6 = Individual_6) 

#View(dispositions_other_characters_1)
#View(dispositions_other_characters_2)
#View(dispositions_other_characters_3)
#View(dispositions_other_characters_4)
#View(dispositions_other_characters_5)
#View(dispositions_other_characters_6)

dispositions <- left_join(dispositions, dispositions_1)
dispositions <- left_join(dispositions, dispositions_other_characters_1)
dispositions <- left_join(dispositions, dispositions_2)
dispositions <- left_join(dispositions, dispositions_other_characters_2)
dispositions <- left_join(dispositions, dispositions_3)
dispositions <- left_join(dispositions, dispositions_other_characters_3)
dispositions <- left_join(dispositions, dispositions_4)
dispositions <- left_join(dispositions, dispositions_other_characters_4)
dispositions <- left_join(dispositions, dispositions_5)
dispositions <- left_join(dispositions, dispositions_other_characters_5)
dispositions <- left_join(dispositions, dispositions_6)
dispositions <- left_join(dispositions, dispositions_other_characters_6)

dispositions <- dispositions[,c(1:4, 11:17, 6, 18:24, 7, 25:31, 8, 32:38, 9, 39:45, 10, 46:52)]
View(dispositions)

```


