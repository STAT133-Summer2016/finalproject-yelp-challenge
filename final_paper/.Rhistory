grid.newpage()
pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
# Make each plot, in the correct location
for (i in 1:numPlots) {
# Get the i,j matrix positions of the regions that contain this subplot
matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
layout.pos.col = matchidx$col))
}
}
}
############################ create the maps ###########################
m <- stops %>%
group_by(Race) %>%
tally()
names(m) <- c("Race", "stop")
names(race) <- c("Race", "census")
pop1 <- left_join(race,m,by = "Race")
pop1 <- pop1 %>%
mutate(percentage=(stop/census))
pop1$percentage<- round(pop1$percentage, digits = 2)
pop1 <- pop1 %>%
mutate(totalp = (census/totalpop))
pop1$totalp <- round(pop1$totalp, digits =2)
p1 <- ggplot(pop1)+
geom_bar(aes(x=Race,
y=percentage),
stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
geom_text(aes(x=Race,
y=percentage,
label = paste0(percentage*100,"%")),
size=5,
colour= "#000000")+
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "The Percentage of Being \nStopped by Police (%)",
x = "Race",
y = "Percentage") +
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
p2 <- ggplot(pop1)+
geom_bar(aes(x=Race,
y=totalp),
stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
geom_text(aes(x=Race,
y=totalp,
label = paste0(totalp*100,"%")),
size=5,
colour= "#000000")+
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "The Percentage of Berkeley \nCensus Data 2010 (%)",
x = "Race",
y = "Percentage") +
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
# stop data map
map_stop1 <- berkgg_zoom2 +
geom_point(data = stops, aes(x=long,y=lat), alpha = .2) +
ggtitle("Berkeley Police Stops, 2015-2016")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# calls for service
map_callservice1 <- berkgg_zoom2 +
geom_point(data = na.omit(callservice), aes(x=long,y=lat), alpha = .2) +
ggtitle("Calls for Service (not criminal reports) \nWithin 180 days (Feb-July 2016)")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
############################ populatrion density map ###########################
popdenmap <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map, aes(x = long, y = lat, group = group, fill = Percent.Berkeley), color = "white", alpha = .7) +
ggtitle("2010 Population Density") +
labs(fill = "Percent") +
scale_fill_gradientn(colors = p) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
# black population:
black2 <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map,
aes(x = long,
y = lat,
group = group,
fill = Percent.Black),
color = "white",
alpha = .7) +
scale_fill_gradientn(colors = p,
limits = c(0,1)) +
guides(fill = "none") +
ggtitle("% Black")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# White population:
w2 <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map,
aes(x = long,
y = lat,
group = group,
fill = Percent.White),
color = "white",
alpha = .7) +
scale_fill_gradientn(colors = p,
limits = c(0,1)) +
guides(fill = "none") +
ggtitle("% White")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# Asian population:
a2 <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map,
aes(x = long,
y = lat,
group = group,
fill = Percent.Asian),
color = "white",
alpha = .7) +
scale_fill_gradientn(colors = p,
limits = c(0,1)) +
guides(fill = "none") +
ggtitle("% Asian")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# Hispanic population:
h2 <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map,
aes(x = long,
y = lat,
group = group,
fill = Percent.Hispanic),
color = "white",
alpha = .7) +
scale_fill_gradientn(colors = p,
limits = c(0,1)) +
guides(fill = "none") +
ggtitle("% Hispanic")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# Other population:
o2 <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map,
aes(x = long,
y = lat,
group = group,
fill = Percent.Other),
color = "white",
alpha = .7) +
scale_fill_gradientn(colors = p,
limits = c(0,1)) +
guides(fill = "none") +
ggtitle("% Other")+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# bar graphs based on stop data:
names(ss)[2:3] <- c("Percent_Stopped", "Percent_Population_Stopped")
per <- ss %>%
mutate(Percent_Stopped= str_replace(Percent_Stopped, "%", "")) %>%
mutate(Percent_Population_Stopped=str_replace(Percent_Population_Stopped, "%", ""))
per$Percent_Stopped <- as.numeric(per$Percent_Stopped)
per$Percent_Stopped <- per$Percent_Stopped/100
per$Percent_Population_Stopped <- as.numeric(per$Percent_Population_Stopped)
per$Percent_Population_Stopped <- per$Percent_Population_Stopped/100
bargraph1 <- ggplot(per,
aes(x=Race,
y=Percent_Stopped,
fill = Race))+
geom_bar(stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0")) +
geom_text(aes(x=Race,
y=Percent_Stopped,
label = paste0(Percent_Stopped*100, "%")),
size=5,
colour= "#000000") +
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "Percent Stopped",
x = "Race",
y = "Percent stopped")+
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank())+
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
bargraph2 <- ggplot(per,
aes(x=Race,
y=Percent_Population_Stopped,
fill = Race))+
geom_bar(stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
geom_text(aes(x=Race,
y=Percent_Population_Stopped,
label = paste0(Percent_Population_Stopped*100, "%")),
size=5,
colour= "#000000") +
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "Percent Population Stopped",
x = "Race",
y = "Percent stopped")+
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank())+
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
# STOP DENSITY MAP:
stopdensitymap <- berkgg_zoom2 +
stat_density2d(aes(x = long, y = lat, fill= ..level.., alpha = .2* ..level..),
size = 2, bins = 5, data = stops, geom = "polygon") +
scale_fill_gradient(low = "black", high = "red") +
theme (panel.grid.major = element_blank (), # remove major grid
panel.grid.minor = element_blank ()  # remove minor grid
)+
ggtitle("All BPD Stops Density, 2015-2016") +
labs(alpha = element_blank()) +
guides(alpha = FALSE)
# stop density
stopdensitymap4 <- berkgg_zoom2 +
stat_density2d(aes(x = long,
y = lat,
fill = ..level..,
alpha = ..level..),
bins = I(5), geom = "polygon", data = stops ) +
scale_fill_gradient2( "StopDensity",
low = "white", mid = "orange", high = "red", midpoint = 100) +
labs(x = "Longitude", y = "Latitude") +
scale_alpha(range = c(.2, .55), guide = FALSE) +
ggtitle("Berkeley Police Stop \nDensity Map, 2015-2016")+
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
############################ populatrion density map ###########################
popdenmap <- berkgg_zoom1 +
geom_polygon(data = berkcensus2010map, aes(x = long, y = lat, group = group, fill = Percent.Berkeley), color = "white", alpha = .7) +
ggtitle("2010 Population Density") +
labs(fill = "Percent") +
scale_fill_gradientn(colors = p) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
# stop density by race
stopdensitymap3 <- berkgg_zoom2 +
stat_density2d(aes(x = long,
y = lat,
fill = ..level..,
alpha = ..level..),
bins = I(5), geom = "polygon", data = stops) +
scale_fill_gradient2("StopDensity",
low = "white", mid = "orange", high = "red", midpoint = 100) +
labs(x = "Longitude", y = "Latitude") + facet_grid( ~ Race) +
scale_alpha(range = c(.2, .55), guide = FALSE) +
ggtitle("Berkeley Police Stop Density Map by Race") +
guides(fill = guide_colorbar(barwidth = 1.5, barheight = 10)) +
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 14),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10)) +
guides(fill = FALSE)
# stops leading to arrests by race:
df <- subset(stops, as.character(Enforcement) == "Arrest")
map_arrested1 <- berkgg_zoom1 +
geom_point(aes(x = long,
y = lat,
colour = Race),
data = df,
alpha = 0.7) +
scale_color_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
theme (
panel.grid.major = element_blank (), # remove major grid
panel.grid.minor = element_blank (),  # remove minor grid
axis.text = element_blank (),
axis.title = element_blank (),
axis.ticks = element_blank ()) +
ggtitle("Police Stops Leading to Arrests") +
facet_grid(~ Race) +
guides(colour = FALSE) +
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 14),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# stops by reason:
stop_reason <- stops[stops$Reason != "Other",]
stop_by_reason_race <- stop_reason %>%
group_by(Race, Reason) %>%
tally()
names(stop_by_reason_race) <- c("Race", "Reason", "totalCount")
stop_by_arrest <- stop_reason[stop_reason$Enforcement == "Arrest",] %>%
group_by(Race, Reason) %>%
tally()
names(stop_by_arrest) <- c("Race", "Reason", "arrestCount")
stop_by_percentage_race <- left_join(stop_by_reason_race, stop_by_arrest, by = c("Race", "Reason"))
stop_by_percentage_race <- stop_by_percentage_race %>%
mutate(percentage = arrestCount / totalCount)
stop_by_percentage_race$percentage <- round(stop_by_percentage_race$percentage, digits = 2)
stop_arrest <- ggplot(stop_by_percentage_race, aes(x = Race,
fill = Race)) +
geom_bar(aes(y = percentage), stat="identity") +
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
facet_wrap(~Reason)+
geom_text(aes(x=Race,
y=percentage,
label = paste0(percentage*100, "%")),
size=4,
colour= "#000000") +
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "The percentage of population \nbeing stopped (%)",
x = "Race",
y = "Density")+
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank())+
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))+
guides(fill = FALSE)
map_reasons1 <- berkgg_zoom2 +
geom_point(aes(x = long,
y = lat,
colour = Reason),
data = stop_reason,
alpha = .7) +
theme (
panel.grid.major = element_blank (), # remove major grid
panel.grid.minor = element_blank (),  # remove minor grid
axis.text = element_blank (),
axis.title = element_blank (),
axis.ticks = element_blank ()) +
ggtitle("Police Stops by Reason")+
facet_grid(~Reason)+
guides(colour = FALSE)+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
stop_reason <- stop_reason %>%
group_by(Race, Reason) %>%
tally()
############################ create the maps ###########################
# arrest data histogram by race
arrest1 <- na.omit(arrest) %>%
group_by(Race) %>%
tally()
total <- arrest1 %>%
tally()
arresttotal <- 192
arrest1 <- arrest1 %>%
mutate(percentage = n/192)
arrest1$percentage <- round(arrest1$percentage, digits = 2)
jail1 <-na.omit(jail) %>%
group_by(Race) %>%
tally()
total <- jail1 %>%
tally()
jailtotal <- 242
jail1<- jail1 %>%
mutate(percentage = n/242)
jail1$percentage <- round(jail1$percentage, digits = 2)
bararrest<- ggplot(arrest1)+
geom_bar(aes(x=Race,
y= percentage),
stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
geom_text(aes(x=Race,
y=percentage,
label = paste0(percentage*100,"%")),
size=5,
colour= "#000000")+
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "The Percentage of Being Arrested \nAfter being Stopped (%)",
x = "Race",
y = "Percentage") +
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
barjail <- ggplot(jail1)+
geom_bar(aes(x=Race,
y=percentage),
stat = "identity",
fill = c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
geom_text(aes(x=Race,
y=percentage,
label = paste0(percentage*100,"%")),
size=5,
colour= "#000000")+
scale_y_continuous(labels=percent, limits = c(0,1)) +
labs(title = "The Percentage of Being jailed \nAfter being Stopped (%)",
x = "Race",
y = "Percentage") +
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7))
histogram_arrest1 <- ggplot(na.omit(arrest))+
geom_bar(aes(x=Age,
fill = Race))+
facet_grid(~Race)+
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
labs(x= "Age",
y = "Number of people",
title = "Arrest Data") +
guides(fill = FALSE)+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 14),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# jail data histogram by race
histogram_jail1 <- ggplot(na.omit(jail))+
geom_bar(aes(x=Age,
fill = Race))+
facet_grid(~Race)+
labs(x= "Age",
y = "Number of people",
title = "Jail Data") +
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
guides(fill = FALSE)+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 14),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
# histogram of stop data by race and hour:
histogram_stoptime1 <- ggplot(stops,
aes(x = Hour,
fill = Race)) +
geom_bar(aes(y = ..count..)) +
facet_grid(~Race)+
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
labs(title = "Number of people each race in every hour",
y = "Count") +
guides(fill = FALSE)+
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 14),
axis.text.x=element_text(colour="black", size = 10),
axis.text.y=element_text(colour="black", size = 10))
table3$Percent.Stopped <- percent(table3$Percent.Stopped)
map_enforcement <- ggplot(table3)+
geom_bar(aes(x=Race,
y=Percent.Stopped,
fill = Race),
stat = "identity") +
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0"))+
scale_y_continuous(limits = c(0,1), labels = c("0%", "25%", "50%", "75%", "100%")) +
labs(title = "Arrested Individuals, by Race",
x = "Race",
y = "Percent of Arrested") +
geom_text(aes(x=Race,
y=Percent.Stopped,
label = paste0(Percent.Stopped)),
size=5,
colour= "#000000")+
scale_x_discrete(labels = function(x) str_wrap(x, width = 5))+
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 14, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 13),
axis.text.x=element_text(colour="black", size = 8),
axis.text.y=element_text(colour="black", size = 8))+
guides(fill = FALSE)
#map_enforcement
race_hour <- read.csv("../clean_data/race_hour.csv")
stop_percentage3 <- ggplot(race_hour, aes(x = Hour, fill = Race)) +
geom_bar(aes(y = percentage), stat="identity") +
labs(title = "Probability of BPD stop for \na specific race in a specific hour",
x= "Hour",
y = "Density") +
facet_wrap(~Race) +
scale_fill_manual(values=c("#FFCC00","#E1B378","#5F9EA0","#66FFCC","#40B8D0")) +
scale_y_continuous(labels=percent, limits = c(0,1)) +
theme(axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(),
panel.border = element_blank(), panel.background = element_blank()) +
theme(plot.title = element_text(size = 12, family = "Georgia", face = "bold"),
text=element_text(family="Times New Roman", size = 10),
axis.text.x=element_text(colour="black", size = 7),
axis.text.y=element_text(colour="black", size = 7)) +
guides(fill = FALSE)
install.packages("xelatex")
